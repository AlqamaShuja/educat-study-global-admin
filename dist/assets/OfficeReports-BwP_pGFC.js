import{b as _,r as n,j as e,L as ee,B as c}from"./index-B8d-T4_g.js";import{u as se}from"./useApi-B1keMs2T.js";import{u as te,T as ae}from"./Toast-COksXIC4.js";import{v as y,c as O}from"./validators-DJSRcNcx.js";import{C as L}from"./Card-BmdFGXxf.js";import{B as z}from"./Badge-C9Vyx7sP.js";import{M as U}from"./Modal-Dk_M0ZsZ.js";import{I as x}from"./Input-DF3u4mg_.js";import{D as le}from"./DataTable-CjQSVmV5.js";import{S as re}from"./shield-CzFdIWOm.js";import{P}from"./plus-B_x-KCg8.js";import{S as de}from"./search-v1ZxCjqm.js";import{C as oe}from"./calendar-dTGyL5Lu.js";import{U as ne}from"./user-check-4txps9Az.js";import{C as B}from"./clock-G7bQhLke.js";import{S as ie}from"./square-pen-BaSEyL2h.js";import{T as ce}from"./trash-2-CIGIiON9.js";import"./userService-fcNfPGgU.js";import"./leadService-C9Fz9Fh8.js";import"./officeService-pIKWPzAM.js";import"./universityService-BRxu1EnD.js";import"./courseService-C7fDnORS.js";import"./messageService-BIb6aoiZ.js";import"./reportService-CwYIj9jA.js";import"./Select-B_IZ9S1v.js";import"./createLucideIcon-Sm81qEul.js";const Ue=()=>{const{user:A}=_(),{callApi:f,services:g,loading:$,error:p}=se(),{hasPermission:u}=te(),[M,v]=n.useState([]),[b,q]=n.useState([]),[d,I]=n.useState({search:"",staffId:"",date:""}),[R,j]=n.useState(!1),[Y,N]=n.useState(!1),[F,S]=n.useState(null),[l,D]=n.useState({}),[w,i]=n.useState({show:!1,message:"",type:"success"}),[a,o]=n.useState({staffId:"",startTime:"",endTime:"",type:"shift",status:"scheduled",notes:""}),T=[{value:"shift",label:"Shift",color:"bg-blue-100 text-blue-800"},{value:"meeting",label:"Meeting",color:"bg-green-100 text-green-800"},{value:"training",label:"Training",color:"bg-yellow-100 text-yellow-800"},{value:"leave",label:"Leave",color:"bg-red-100 text-red-800"}],k=[{value:"scheduled",label:"Scheduled",color:"bg-blue-100 text-blue-800"},{value:"completed",label:"Completed",color:"bg-green-100 text-green-800"},{value:"cancelled",label:"Cancelled",color:"bg-gray-100 text-gray-800"}];n.useEffect(()=>{A&&u("manage","schedules")&&(G(),H())},[A]);const G=async()=>{try{const s=await f(g.user.getTeamMembers);q((s==null?void 0:s.map(t=>({id:t.id,name:y(t.name)})))||[])}catch{i({show:!0,message:p||"Failed to fetch staff members",type:"error"})}},H=async()=>{try{const s=await f(g.schedule.getSchedules);v((s==null?void 0:s.map(t=>({id:t.id,staffId:t.staffId,staffName:y(t.staffName||"Unknown"),startTime:t.startTime,endTime:t.endTime,type:t.type,status:t.status,notes:y(t.notes||"")})))||[])}catch{i({show:!0,message:p||"Failed to fetch schedules",type:"error"})}},J=async()=>{const s=O(a);if(Object.keys(s).length){D(s);return}try{const t=await f(g.schedule.createSchedule,{...a,startTime:new Date(a.startTime).toISOString(),endTime:new Date(a.endTime).toISOString(),notes:y(a.notes)});v(r=>{var m;return[...r,{...t,staffName:((m=b.find(C=>C.id===t.staffId))==null?void 0:m.name)||"Unknown"}]}),j(!1),h(),i({show:!0,message:"Schedule added successfully!",type:"success"})}catch{i({show:!0,message:p||"Failed to add schedule",type:"error"})}},K=async()=>{const s=O(a);if(Object.keys(s).length){D(s);return}try{const t=await f(g.schedule.updateSchedule,F.id,{...a,startTime:new Date(a.startTime).toISOString(),endTime:new Date(a.endTime).toISOString(),notes:y(a.notes)});v(r=>r.map(m=>{var C;return m.id===F.id?{...t,staffName:((C=b.find(Z=>Z.id===t.staffId))==null?void 0:C.name)||"Unknown"}:m})),N(!1),S(null),h(),i({show:!0,message:"Schedule updated successfully!",type:"success"})}catch{i({show:!0,message:p||"Failed to update schedule",type:"error"})}},Q=async s=>{if(window.confirm("Are you sure you want to delete this schedule?"))try{await f(g.schedule.deleteSchedule,s),v(t=>t.filter(r=>r.id!==s)),i({show:!0,message:"Schedule deleted successfully!",type:"success"})}catch{i({show:!0,message:p||"Failed to delete schedule",type:"error"})}},h=()=>{o({staffId:"",startTime:"",endTime:"",type:"shift",status:"scheduled",notes:""}),D({})},E=M.filter(s=>{const t=!d.search||s.staffName.toLowerCase().includes(d.search.toLowerCase())||s.notes.toLowerCase().includes(d.search.toLowerCase()),r=!d.staffId||s.staffId===d.staffId,m=!d.date||new Date(s.startTime).toDateString()===new Date(d.date).toDateString();return t&&r&&m}),V=s=>{var t;return((t=T.find(r=>r.value===s))==null?void 0:t.color)||"bg-gray-100 text-gray-800"},W=s=>{var t;return((t=k.find(r=>r.value===s))==null?void 0:t.color)||"bg-gray-100 text-gray-800"},X=[{key:"staffName",label:"Staff",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.staffName})]})},{key:"startTime",label:"Start Time",render:s=>e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),new Date(s.startTime).toLocaleString()]})},{key:"endTime",label:"End Time",render:s=>e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),new Date(s.endTime).toLocaleString()]})},{key:"type",label:"Type",render:s=>{var t;return e.jsx(z,{className:V(s.type),children:(t=T.find(r=>r.value===s.type))==null?void 0:t.label})}},{key:"status",label:"Status",render:s=>{var t;return e.jsx(z,{className:W(s.status),children:(t=k.find(r=>r.value===s.status))==null?void 0:t.label})}},{key:"notes",label:"Notes",render:s=>e.jsx("span",{className:"text-sm",children:s.notes||"N/A"})},{key:"actions",label:"Actions",render:s=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{S(s),o({staffId:s.staffId,startTime:new Date(s.startTime).toISOString().slice(0,16),endTime:new Date(s.endTime).toISOString().slice(0,16),type:s.type,status:s.status,notes:s.notes}),N(!0)},disabled:!u("edit","schedules"),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Q(s.id),className:"border-red-300 text-red-600 hover:bg-red-50",disabled:!u("delete","schedules"),children:e.jsx(ce,{className:"h-4 w-4"})})]})}];return $?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ee,{size:"lg"})}):u("manage","schedules")?e.jsxs("div",{className:"space-y-6",children:[e.jsx(ae,{isOpen:w.show,message:w.message,type:w.type,onClose:()=>i({...w,show:!1})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Staff Schedules"}),e.jsx("p",{className:"text-gray-600",children:"Manage schedules for your team members."})]}),e.jsxs(c,{onClick:()=>j(!0),disabled:!u("create","schedules"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Schedule"]})]}),e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(x,{placeholder:"Search by staff or notes...",value:d.search,onChange:s=>I({...d,search:s.target.value}),className:"pl-10"})]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:d.staffId,onChange:s=>I({...d,staffId:s.target.value}),children:[e.jsx("option",{value:"",children:"All Staff"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(x,{type:"date",value:d.date,onChange:s=>I({...d,date:s.target.value}),placeholder:"Filter by date"}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[E.length," of ",M.length," schedules"]})]})}),e.jsxs(L,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Staff Schedules"}),E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No schedules found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:Object.values(d).some(s=>s)?"No schedules match your current filters.":"Add your first schedule to get started."}),e.jsxs(c,{onClick:()=>j(!0),disabled:!u("create","schedules"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add First Schedule"]})]}):e.jsx(le,{data:E,columns:X,pagination:!0,pageSize:10})]}),e.jsx(U,{isOpen:R,onClose:()=>{j(!1),h()},title:"Add Schedule",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Staff Member *"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${l.staffId?"border-red-500":""}`,value:a.staffId,onChange:s=>o({...a,staffId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a staff member"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),l.staffId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.staffId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),e.jsx(x,{type:"datetime-local",value:a.startTime,onChange:s=>o({...a,startTime:s.target.value}),className:l.startTime?"border-red-500":""}),l.startTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time *"}),e.jsx(x,{type:"datetime-local",value:a.endTime,onChange:s=>o({...a,endTime:s.target.value}),className:l.endTime?"border-red-500":""}),l.endTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:a.type,onChange:s=>o({...a,type:s.target.value}),children:T.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:a.status,onChange:s=>o({...a,status:s.target.value}),children:k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:3,value:a.notes,onChange:s=>o({...a,notes:s.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(c,{variant:"outline",onClick:()=>{j(!1),h()},children:"Cancel"}),e.jsx(c,{onClick:J,children:"Add Schedule"})]})]})}),e.jsx(U,{isOpen:Y,onClose:()=>{N(!1),S(null),h()},title:"Edit Schedule",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Staff Member *"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${l.staffId?"border-red-500":""}`,value:a.staffId,onChange:s=>o({...a,staffId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a staff member"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),l.staffId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.staffId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),e.jsx(x,{type:"datetime-local",value:a.startTime,onChange:s=>o({...a,startTime:s.target.value}),className:l.startTime?"border-red-500":""}),l.startTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time *"}),e.jsx(x,{type:"datetime-local",value:a.endTime,onChange:s=>o({...a,endTime:s.target.value}),className:l.endTime?"border-red-500":""}),l.endTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:a.type,onChange:s=>o({...a,type:s.target.value}),children:T.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:a.status,onChange:s=>o({...a,status:s.target.value}),children:k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:3,value:a.notes,onChange:s=>o({...a,notes:s.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(c,{variant:"outline",onClick:()=>{N(!1),S(null),h()},children:"Cancel"}),e.jsx(c,{onClick:K,children:"Update Schedule"})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You do not have permission to manage staff schedules."})]})};export{Ue as default};
