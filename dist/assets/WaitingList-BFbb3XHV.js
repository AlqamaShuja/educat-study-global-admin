import{r as c,j as e,L as G,B as u,g as q}from"./index-B8d-T4_g.js";import{u as R}from"./useApi-B1keMs2T.js";import{u as Y}from"./useAuth-CiCdcs1m.js";import{u as H,T as J}from"./Toast-COksXIC4.js";import{v as n,e as K}from"./validators-DJSRcNcx.js";import{C as L}from"./Card-BmdFGXxf.js";import{B as Q}from"./Badge-C9Vyx7sP.js";import{I as f}from"./Input-DF3u4mg_.js";import{D as V}from"./DataTable-CjQSVmV5.js";import{M as X}from"./Modal-Dk_M0ZsZ.js";import{S as Z}from"./shield-CzFdIWOm.js";import{P as D}from"./plus-B_x-KCg8.js";import{S as _}from"./search-v1ZxCjqm.js";import{C as A}from"./clock-G7bQhLke.js";import{U as P}from"./user-B-VtmG-j.js";import{M as ee}from"./mail-DBCuZO0A.js";import{P as se}from"./phone-Dncapw21.js";import{C as te}from"./calendar-dTGyL5Lu.js";import{S as ae}from"./square-pen-BaSEyL2h.js";import{T as re}from"./trash-2-CIGIiON9.js";import"./userService-fcNfPGgU.js";import"./leadService-C9Fz9Fh8.js";import"./officeService-pIKWPzAM.js";import"./universityService-BRxu1EnD.js";import"./courseService-C7fDnORS.js";import"./messageService-BIb6aoiZ.js";import"./reportService-CwYIj9jA.js";import"./Select-B_IZ9S1v.js";import"./createLucideIcon-Sm81qEul.js";const Fe=()=>{const{user:k}=Y(),{callApi:x,loading:F,error:j}=R(),{hasPermission:m}=H(),[S,N]=c.useState([]),[T,W]=c.useState([]),[l,v]=c.useState({search:"",consultantId:"",status:""}),[p,h]=c.useState({show:!1,mode:"add",entry:null}),[r,E]=c.useState({}),[b,d]=c.useState({show:!1,message:"",type:"success"}),[a,o]=c.useState({clientName:"",email:"",phone:"",preferredConsultantId:"",preferredDateTime:"",status:"pending",notes:""}),w=[{value:"pending",label:"Pending",color:"bg-yellow-100 text-yellow-800"},{value:"assigned",label:"Assigned",color:"bg-green-100 text-green-800"},{value:"canceled",label:"Canceled",color:"bg-red-100 text-red-800"}];c.useEffect(()=>{k&&m("manage","waiting-list")&&(M(),$())},[k]);const M=async()=>{try{const s=await x("GET","/receptionist/consultants");W((s==null?void 0:s.map(t=>({id:t.id,name:n(t.name)})))||[])}catch{d({show:!0,message:j||"Failed to fetch consultants",type:"error"})}},$=async()=>{try{const s=await x("GET","/receptionist/waiting-list");N((s==null?void 0:s.map(t=>({id:t.id,clientId:t.clientId,clientName:n(t.clientName||"Unknown"),email:n(t.email||"N/A"),phone:n(t.phone||"N/A"),preferredConsultantId:t.preferredConsultantId,preferredConsultantName:n(t.preferredConsultantName||"Any"),preferredDateTime:t.preferredDateTime,status:t.status,notes:n(t.notes||"")})))||[])}catch{d({show:!0,message:j||"Failed to fetch waiting list",type:"error"})}},z=async()=>{const s=K(a);if(Object.keys(s).length){E(s);return}try{const t={...a,clientName:n(a.clientName),email:n(a.email),phone:n(a.phone),notes:n(a.notes)};if(p.mode==="add"){const i=await x("POST","/receptionist/waiting-list",t);N(g=>[...g,i]),d({show:!0,message:"Client added to waiting list!",type:"success"})}else{const i=await x("PUT",`/receptionist/waiting-list/${p.entry.id}`,t);N(g=>g.map(I=>I.id===i.id?i:I)),d({show:!0,message:"Waiting list entry updated!",type:"success"})}h({show:!1,mode:"add",entry:null}),y()}catch{d({show:!0,message:j||"Failed to save entry",type:"error"})}},O=async s=>{if(window.confirm("Are you sure you want to remove this client from the waiting list?"))try{await x("DELETE",`/receptionist/waiting-list/${s}`),N(t=>t.filter(i=>i.id!==s)),d({show:!0,message:"Client removed from waiting list!",type:"success"})}catch{d({show:!0,message:j||"Failed to delete entry",type:"error"})}},y=()=>{o({clientName:"",email:"",phone:"",preferredConsultantId:"",preferredDateTime:"",status:"pending",notes:""}),E({})},C=S.filter(s=>{const t=!l.search||s.clientName.toLowerCase().includes(l.search.toLowerCase())||s.email.toLowerCase().includes(l.search.toLowerCase())||s.phone.includes(l.search),i=!l.consultantId||s.preferredConsultantId===l.consultantId,g=!l.status||s.status===l.status;return t&&i&&g}),U=s=>{var t;return((t=w.find(i=>i.value===s))==null?void 0:t.color)||"bg-gray-100 text-gray-800"},B=[{key:"clientName",label:"Client",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.clientName})]})},{key:"email",label:"Email",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.email})]})},{key:"phone",label:"Phone",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.phone})]})},{key:"preferredConsultantName",label:"Preferred Consultant",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.preferredConsultantName})]})},{key:"preferredDateTime",label:"Preferred Date/Time",render:s=>e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),new Date(s.preferredDateTime).toLocaleString()]})},{key:"status",label:"Status",render:s=>{var t;return e.jsx(Q,{className:U(s.status),children:(t=w.find(i=>i.value===s.status))==null?void 0:t.label})}},{key:"notes",label:"Notes",render:s=>e.jsx("span",{className:"text-sm",children:s.notes||"N/A"})},{key:"actions",label:"Actions",render:s=>e.jsxs("div",{className:"flex space-x-2",children:[s.status==="pending"&&e.jsx(q,{to:`/receptionist/appointments/booking?clientId=${s.clientId}&consultantId=${s.preferredConsultantId}`,children:e.jsx(u,{size:"sm",variant:"outline",disabled:!m("create","appointments"),className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{h({show:!0,mode:"edit",entry:s}),o({clientName:s.clientName,email:s.email,phone:s.phone,preferredConsultantId:s.preferredConsultantId,preferredDateTime:s.preferredDateTime,status:s.status,notes:s.notes})},disabled:!m("edit","waiting-list"),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>O(s.id),className:"border-red-300 text-red-600 hover:bg-red-50",disabled:!m("delete","waiting-list"),children:e.jsx(re,{className:"h-4 w-4"})})]})}];return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"lg"})}):m("manage","waiting-list")?e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{isOpen:b.show,message:b.message,type:b.type,onClose:()=>d({...b,show:!1})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Waiting List"}),e.jsx("p",{className:"text-gray-600",children:"Manage clients awaiting appointments."})]}),e.jsxs(u,{onClick:()=>h({show:!0,mode:"add",entry:null}),disabled:!m("create","waiting-list"),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add Client"]})]}),e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(f,{placeholder:"Search by name, email, or phone...",value:l.search,onChange:s=>v({...l,search:s.target.value}),className:"pl-10"})]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:l.consultantId,onChange:s=>v({...l,consultantId:s.target.value}),children:[e.jsx("option",{value:"",children:"All Consultants"}),T.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:l.status,onChange:s=>v({...l,status:s.target.value}),children:[e.jsx("option",{value:"",children:"All Statuses"}),w.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[C.length," of ",S.length," entries"]})]})}),e.jsxs(L,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Waiting List"}),C.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No waiting list entries"}),e.jsx("p",{className:"text-gray-600 mb-4",children:Object.values(l).some(s=>s)?"No entries match your current filters.":"Add a client to the waiting list to get started."}),e.jsxs(u,{onClick:()=>h({show:!0,mode:"add",entry:null}),disabled:!m("create","waiting-list"),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add First Client"]})]}):e.jsx(V,{data:C,columns:B,pagination:!0,pageSize:10})]}),e.jsx(X,{isOpen:p.show,onClose:()=>{h({show:!1,mode:"add",entry:null}),y()},title:p.mode==="add"?"Add Client to Waiting List":"Edit Waiting List Entry",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Client Name *"}),e.jsx(f,{value:a.clientName,onChange:s=>o({...a,clientName:s.target.value}),placeholder:"Enter client name",className:r.clientName?"border-red-500":""}),r.clientName&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.clientName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx(f,{type:"email",value:a.email,onChange:s=>o({...a,email:s.target.value}),placeholder:"Enter client email",className:r.email?"border-red-500":""}),r.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx(f,{type:"tel",value:a.phone,onChange:s=>o({...a,phone:s.target.value}),placeholder:"Enter client phone",className:r.phone?"border-red-500":""}),r.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Consultant"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${r.preferredConsultantId?"border-red-500":""}`,value:a.preferredConsultantId,onChange:s=>o({...a,preferredConsultantId:s.target.value}),children:[e.jsx("option",{value:"",children:"Any Consultant"}),T.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),r.preferredConsultantId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.preferredConsultantId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Date/Time"}),e.jsx(f,{type:"datetime-local",value:a.preferredDateTime,onChange:s=>o({...a,preferredDateTime:s.target.value}),className:r.preferredDateTime?"border-red-500":""}),r.preferredDateTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.preferredDateTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${r.status?"border-red-500":""}`,value:a.status,onChange:s=>o({...a,status:s.target.value}),children:w.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),r.status&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:3,value:a.notes,onChange:s=>o({...a,notes:s.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(u,{variant:"outline",onClick:()=>{h({show:!1,mode:"add",entry:null}),y()},children:"Cancel"}),e.jsx(u,{onClick:z,children:p.mode==="add"?"Add Client":"Update Entry"})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You do not have permission to manage the waiting list."})]})};export{Fe as default};
