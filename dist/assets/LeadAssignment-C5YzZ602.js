import{b as Q,r as l,j as s,L as R,B as b}from"./index-D_0a8VZH.js";import{u as Y}from"./useApi-DlTBhoZ7.js";import{u as G,T as H}from"./Toast-CHm3WShd.js";import{v as g,d as J}from"./validators-DJSRcNcx.js";import{C as E}from"./Card-BZSd9g6-.js";import{B as K}from"./Badge-DnoA-fpa.js";import{M as V}from"./Modal-C-TYXrEH.js";import{I as W}from"./Input-CvXmBRSW.js";import{D as X}from"./DataTable-DA-IZIQM.js";import{S as Z}from"./shield-CmwMQLwg.js";import{P as _}from"./plus-DFJI7CJl.js";import{S as ee}from"./search-WQZEDZzZ.js";import{U as se}from"./users-8DbqKR1r.js";import{U as ae}from"./user-check-dM6SSSkL.js";import{M as te}from"./mail-NeauaYI_.js";import{T as re}from"./target-Bd_0vASp.js";import{S as le}from"./square-check-big-m-Ggu3E7.js";import"./userService-CYy00l9J.js";import"./leadService-BGFHSqvN.js";import"./officeService-CJb98nQG.js";import"./universityService-33LqWS7T.js";import"./courseService-BvKQP8zl.js";import"./messageService-C7q2WohE.js";import"./reportService-BE-X8rSB.js";import"./Select-DcciDOjL.js";import"./createLucideIcon-QavIXzvy.js";const Be=()=>{const{user:A}=Q(),{callApi:y,services:v,loading:B,error:N}=Y(),{hasPermission:x}=G(),[C,L]=l.useState([]),[M,U]=l.useState([]),[r,k]=l.useState({search:"",status:""}),[n,c]=l.useState([]),[D,d]=l.useState(!1),[m,T]=l.useState(!1),[i,F]=l.useState({}),[h,u]=l.useState({show:!1,message:"",type:"success"}),[o,p]=l.useState({assignedTo:"",status:"new"}),f=[{value:"new",label:"New",color:"bg-blue-100 text-blue-800"},{value:"contacted",label:"Contacted",color:"bg-yellow-100 text-yellow-800"},{value:"qualified",label:"Qualified",color:"bg-green-100 text-green-800"},{value:"converted",label:"Converted",color:"bg-purple-100 text-purple-800"},{value:"lost",label:"Lost",color:"bg-red-100 text-red-800"}];l.useEffect(()=>{A&&x("manage","leads")&&(I(),P())},[A]);const I=async()=>{try{const e=await y(v.lead.getLeads,{assigned:!1});L((e==null?void 0:e.map(a=>{var t,j;return{id:a.id,studentId:a.studentId,name:g(((t=a.student)==null?void 0:t.name)||"Unknown"),email:g(((j=a.student)==null?void 0:j.email)||"N/A"),status:a.status,assignedTo:a.assignedTo,assignedToName:g(a.assignedToName||"Unassigned"),source:g(a.source||"N/A"),createdAt:new Date(a.createdAt).toLocaleDateString()}}))||[])}catch{u({show:!0,message:N||"Failed to fetch leads",type:"error"})}},P=async()=>{try{const e=await y(v.user.getTeamMembers);U((e==null?void 0:e.filter(a=>a.role==="consultant").map(a=>({id:a.id,name:g(a.name)})))||[])}catch{u({show:!0,message:N||"Failed to fetch consultants",type:"error"})}},z=async()=>{const e=J(o);if(Object.keys(e).length){F(e);return}try{const a=m?n:[n[0]];await Promise.all(a.map(t=>y(v.lead.assignLead,t,{assignedTo:o.assignedTo,status:o.status}))),L(t=>t.filter(j=>!a.includes(j.id))),c([]),d(!1),w(),u({show:!0,message:`Lead${a.length>1?"s":""} assigned successfully!`,type:"success"})}catch{u({show:!0,message:N||"Failed to assign lead(s)",type:"error"})}},O=e=>{c(a=>a.includes(e)?a.filter(t=>t!==e):[...a,e])},w=()=>{p({assignedTo:"",status:"new"}),F({}),T(!1)},S=C.filter(e=>{const a=!r.search||e.name.toLowerCase().includes(r.search.toLowerCase())||e.email.toLowerCase().includes(r.search.toLowerCase()),t=!r.status||e.status===r.status;return a&&t}),$=e=>{var a;return((a=f.find(t=>t.value===e))==null?void 0:a.color)||"bg-gray-100 text-gray-800"},q=[{key:"select",label:"",render:e=>s.jsx("input",{type:"checkbox",checked:n.includes(e.id),onChange:()=>O(e.id),className:"h-4 w-4 text-indigo-600 border-gray-300 rounded"})},{key:"name",label:"Name",render:e=>s.jsxs("div",{className:"flex items-center",children:[s.jsx(ae,{className:"h-4 w-4 text-gray-400 mr-2"}),s.jsx("span",{className:"text-sm",children:e.name})]})},{key:"email",label:"Email",render:e=>s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{className:"h-4 w-4 text-gray-400 mr-2"}),s.jsx("span",{className:"text-sm",children:e.email})]})},{key:"status",label:"Status",render:e=>{var a;return s.jsx(K,{className:$(e.status),children:(a=f.find(t=>t.value===e.status))==null?void 0:a.label})}},{key:"source",label:"Source",render:e=>s.jsx("span",{className:"text-sm",children:e.source})},{key:"createdAt",label:"Created At",render:e=>s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(re,{className:"h-4 w-4 mr-1"}),e.createdAt]})},{key:"actions",label:"Actions",render:e=>s.jsx(b,{size:"sm",variant:"outline",onClick:()=>{c([e.id]),p({assignedTo:e.assignedTo||"",status:e.status}),d(!0)},disabled:!x("edit","leads"),children:s.jsx(le,{className:"h-4 w-4"})})}];return B?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(R,{size:"lg"})}):x("manage","leads")?s.jsxs("div",{className:"space-y-6",children:[s.jsx(H,{isOpen:h.show,message:h.message,type:h.type,onClose:()=>u({...h,show:!1})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lead Assignment"}),s.jsx("p",{className:"text-gray-600",children:"Assign unassigned leads to consultants."})]}),n.length>0&&s.jsxs(b,{onClick:()=>{T(!0),d(!0)},disabled:!x("edit","leads"),children:[s.jsx(_,{className:"h-4 w-4 mr-2"}),"Assign Selected (",n.length,")"]})]}),s.jsx(E,{className:"p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(W,{placeholder:"Search by name or email...",value:r.search,onChange:e=>k({...r,search:e.target.value}),className:"pl-10"})]}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:r.status,onChange:e=>k({...r,status:e.target.value}),children:[s.jsx("option",{value:"",children:"All Statuses"}),f.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),s.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[S.length," of ",C.length," unassigned leads"]})]})}),s.jsxs(E,{className:"p-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Unassigned Leads"}),S.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(se,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No unassigned leads found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:Object.values(r).some(e=>e)?"No leads match your current filters.":"All leads are currently assigned."})]}):s.jsx(X,{data:S,columns:q,pagination:!0,pageSize:10})]}),s.jsx(V,{isOpen:D,onClose:()=>{d(!1),c(m?n:[]),w()},title:m?`Assign ${n.length} Leads`:"Assign Lead",size:"md",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultant *"}),s.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${i.assignedTo?"border-red-500":""}`,value:o.assignedTo,onChange:e=>p({...o,assignedTo:e.target.value}),children:[s.jsx("option",{value:"",children:"Select a consultant"}),M.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),i.assignedTo&&s.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.assignedTo})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),s.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${i.status?"border-red-500":""}`,value:o.status,onChange:e=>p({...o,status:e.target.value}),children:[s.jsx("option",{value:"",children:"Select a status"}),f.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),i.status&&s.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.status})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(b,{variant:"outline",onClick:()=>{d(!1),c(m?n:[]),w()},children:"Cancel"}),s.jsx(b,{onClick:z,children:m?"Assign Leads":"Assign Lead"})]})]})})]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),s.jsx("p",{className:"text-gray-600",children:"You do not have permission to assign leads."})]})};export{Be as default};
