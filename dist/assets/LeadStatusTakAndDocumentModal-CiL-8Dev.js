import{r as $,j as e,R as V,B as o,L as U,y as n}from"./index-D_0a8VZH.js";import{u as j}from"./index.esm-D1kEuNb-.js";import{a as N,o as y,e as A,s as k}from"./types-DPbsuHNA.js";import{M as H}from"./Modal-C-TYXrEH.js";import{L as G}from"./LeadDetailsView-DOawn3lM.js";import{f as u}from"./format-CW8_DxCc.js";const v=({defaultTab:t=0,children:a,className:s="",variant:c="default",onChange:i})=>{const[d,b]=$.useState(t),h=m=>{b(m),i&&i(m)},p={default:{container:"border-b border-gray-200",tab:"py-2 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300",activeTab:"py-2 px-4 text-sm font-medium text-blue-600 border-b-2 border-blue-500"},pills:{container:"flex space-x-1 bg-gray-100 p-1 rounded-lg",tab:"px-3 py-1.5 text-sm font-medium text-gray-500 hover:text-gray-700 rounded-md hover:bg-white",activeTab:"px-3 py-1.5 text-sm font-medium text-blue-600 bg-white rounded-md shadow-sm"}};return e.jsxs("div",{className:s,children:[e.jsx("div",{className:p[c].container,children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:V.Children.map(a,(m,x)=>e.jsx("button",{className:d===x?p[c].activeTab:p[c].tab,onClick:()=>h(x),type:"button",children:m.props.label},x))})}),e.jsx("div",{className:"mt-4",children:V.Children.toArray(a)[d]})]})},J=({children:t,label:a})=>e.jsx("div",{children:t});v.Panel=J;const K=y({status:A(["new","in_progress","converted","lost"])}),O=y({note:k().min(1,"Note is required")}),Q=y({dateTime:k().refine(t=>!isNaN(Date.parse(t)),{message:"Invalid date format"}),type:A(["in_person","virtual"])}),W=y({description:k().min(1,"Task description is required"),dueDate:k().refine(t=>!isNaN(Date.parse(t)),{message:"Invalid date format"})}),X=y({status:A(["pending","completed"])}),D=({columns:t,data:a,onSelectLead:s,onTaskStatusChange:c})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-blue-200 rounded-lg",children:[e.jsx("thead",{className:"bg-blue-50",children:e.jsx("tr",{children:t.map((i,d)=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-blue-800 uppercase tracking-wider",children:i.header},d))})}),e.jsx("tbody",{children:a!=null&&a.length?a.map((i,d)=>e.jsx("tr",{className:d%2===0?"bg-white":"bg-blue-50",children:t.map((b,h)=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-800",children:typeof b.accessor=="function"?b.accessor({...i,onSelectLead:s,onTaskStatusChange:c}):i[b.accessor]||"N/A"},h))},d)):e.jsx("tr",{children:e.jsx("td",{colSpan:t.length,className:"px-6 py-8 text-center text-blue-600",children:"No data available."})})})]})}),Y=[{header:"Type",accessor:"type"},{header:"File",accessor:t=>e.jsx("a",{href:`http://44.204.177.187/api/v1/file/documents/${t.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"View File"})},{header:"Status",accessor:"status"},{header:"Expiry Date",accessor:t=>t.expiryDate?u(new Date(t.expiryDate),"PPP"):"N/A"},{header:"Notes",accessor:"notes"},{header:"Created At",accessor:t=>u(new Date(t.createdAt),"PPP")},{header:"Updated At",accessor:t=>u(new Date(t.updatedAt),"PPP")}],Z=[{header:"ID",accessor:"id"},{header:"Lead ID",accessor:"leadId"},{header:"Description",accessor:"description"},{header:"Due Date",accessor:t=>t.dueDate?u(new Date(t.dueDate),"PPP"):"N/A"},{header:"Status",accessor:"status"},{header:"Actions",accessor:t=>e.jsx(o,{variant:"outline",size:"sm",onClick:()=>t.onTaskStatusChange(t.id,t.status==="pending"?"completed":"pending"),className:"border-blue-200 text-blue-600 hover:bg-blue-200 transition-colors duration-200",children:"Toggle Status"})},{header:"Created At",accessor:t=>u(new Date(t.createdAt),"PPP")},{header:"Updated At",accessor:t=>u(new Date(t.updatedAt),"PPP")}],L=[{header:"Action/Note",accessor:t=>t.note||t.action},{header:"User",accessor:t=>t.userRole},{header:"Timestamp",accessor:t=>u(new Date(t.timestamp),"PPP p")}],oe=({isOpen:t,onClose:a,selectedLead:s,tasks:c,documents:i,fetchLeadTasks:d,fetchLeadDocuments:b,updateLeadStatus:h,addConsultationNote:p,setFollowUpTask:m,scheduleMeeting:x,updateTaskStatus:_,loading:C})=>{var M;const F=j({resolver:N(K),defaultValues:{status:"new"}}),I=j({resolver:N(O),defaultValues:{note:""}}),S=j({resolver:N(Q),defaultValues:{dateTime:"",type:"virtual"}}),P=j({resolver:N(W),defaultValues:{description:"",dueDate:""}});j({resolver:N(X),defaultValues:{status:"pending"}});const E=async r=>{var l;try{await h(s.id,r.status),n.success(`Status updated for ${(l=s.student)==null?void 0:l.name}`),a()}catch{n.error("Failed to update lead status")}},R=async r=>{var l;try{await p(s.id,r.note),n.success(`Note added for ${(l=s.student)==null?void 0:l.name}`),a()}catch{n.error("Failed to add note")}},q=async r=>{var l;try{await x(s.studentId,r),n.success(`Meeting scheduled with ${(l=s.student)==null?void 0:l.name}`),a()}catch{n.error("Failed to schedule meeting")}},z=async r=>{var l;try{await m(s.id,r),n.success(`Task added for ${(l=s.student)==null?void 0:l.name}`),a()}catch{n.error("Failed to add task")}},B=async(r,l)=>{try{await _(r,l),n.success("Task status updated"),d(s.id)}catch{n.error("Failed to update task status")}},w=r=>{f(r)},[g,f]=$.useState(null);return s?e.jsxs(H,{isOpen:t,onClose:a,title:`${(M=s.student)==null?void 0:M.name}'s Details`,className:"max-w-4xl mx-auto bg-white rounded-xl border border-blue-200",size:"full",children:[g==="status"&&e.jsxs("form",{onSubmit:F.handleSubmit(E),className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-800",children:"Update Status"}),e.jsxs("select",{...F.register("status"),className:"w-full p-2 border border-blue-200 rounded-md bg-white text-blue-800 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"converted",children:"Converted"}),e.jsx("option",{value:"lost",children:"Lost"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Update"}),e.jsx(o,{variant:"outline",onClick:()=>f(null),className:"border-blue-200 text-blue-600 hover:bg-blue-200 transition-colors duration-200",children:"Cancel"})]})]}),g==="note"&&e.jsxs("form",{onSubmit:I.handleSubmit(R),className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-800",children:"Add Note"}),e.jsx("textarea",{...I.register("note"),className:"w-full p-2 border border-blue-200 rounded-md bg-white text-blue-800 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter consultation note",rows:4}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Add Note"}),e.jsx(o,{variant:"outline",onClick:()=>f(null),className:"border-blue-200 text-blue-600 hover:bg-blue-200 transition-colors duration-200",children:"Cancel"})]})]}),g==="meeting"&&e.jsxs("form",{onSubmit:S.handleSubmit(q),className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-800",children:"Schedule Meeting"}),e.jsx("input",{type:"datetime-local",...S.register("dateTime"),className:"w-full p-2 border border-blue-200 rounded-md bg-white text-blue-800 focus:ring-purple-500 focus:border-purple-500"}),e.jsxs("select",{...S.register("type"),className:"w-full p-2 border border-blue-200 rounded-md bg-white text-blue-800 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"virtual",children:"Virtual"}),e.jsx("option",{value:"in_person",children:"In Person"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Schedule"}),e.jsx(o,{variant:"outline",onClick:()=>f(null),className:"border-blue-200 text-blue-600 hover:bg-blue-200 transition-colors duration-200",children:"Cancel"})]})]}),g==="task"&&e.jsxs("form",{onSubmit:P.handleSubmit(z),className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-800",children:"Add Task"}),e.jsx("input",{type:"text",...P.register("description"),className:"w-full p-2 border border-blue-200 rounded-md bg-white text-blue-800 focus:ring-purple-500 focus:border-purple-500",placeholder:"Task description"}),e.jsx("input",{type:"datetime-local",...P.register("dueDate"),className:"w-full p-2 border border-blue-200 rounded-md bg-white text-blue-800 focus:ring-purple-500 focus:border-purple-500"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Add Task"}),e.jsx(o,{variant:"outline",onClick:()=>f(null),className:"border-blue-200 text-blue-600 hover:bg-blue-200 transition-colors duration-200",children:"Cancel"})]})]}),!g&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{lead:s,className:""}),e.jsxs(v,{defaultTab:0,className:"space-y-4",children:[e.jsx(v.Panel,{label:"Tasks",children:e.jsxs("div",{className:"space-y-4",children:[C?e.jsx(U,{className:"mx-auto h-8 w-8 text-blue-500"}):e.jsx(D,{columns:Z,data:c,onTaskStatusChange:B,leadId:s.id}),e.jsx(o,{onClick:()=>w("task"),className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Add Task"})]})}),e.jsx(v.Panel,{label:"Documents",children:e.jsx("div",{className:"space-y-4",children:C?e.jsx(U,{className:"mx-auto h-8 w-8 text-blue-500"}):e.jsx(D,{columns:Y,data:i.map(r=>({...r,leadId:s.id}))})})}),e.jsx(v.Panel,{label:"History",children:e.jsx("div",{className:"space-y-4",children:e.jsx(D,{columns:L,data:s.history})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(o,{onClick:()=>w("status"),className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Update Status"}),e.jsx(o,{onClick:()=>w("note"),className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Add Note"}),e.jsx(o,{onClick:()=>w("meeting"),className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:"Schedule Meeting"})]})]})]}):null};export{oe as L};
