import{r as i,j as e,L as H,B as f}from"./index-B8d-T4_g.js";import{u as J}from"./useApi-B1keMs2T.js";import{u as K}from"./useAuth-CiCdcs1m.js";import{u as Q,T as V}from"./Toast-COksXIC4.js";import{v as x,b as W}from"./validators-DJSRcNcx.js";import{C as I}from"./Card-BmdFGXxf.js";import{B as X}from"./Badge-C9Vyx7sP.js";import{I as w}from"./Input-DF3u4mg_.js";import{S as g}from"./Select-B_IZ9S1v.js";import{D as Z}from"./DataTable-CjQSVmV5.js";import{S as _}from"./shield-CzFdIWOm.js";import{P as L}from"./plus-B_x-KCg8.js";import{S as ee}from"./search-v1ZxCjqm.js";import{U as P}from"./user-B-VtmG-j.js";import{M as se}from"./mail-DBCuZO0A.js";import{B as ae}from"./building-CT81CbEE.js";import{S as te}from"./square-pen-BaSEyL2h.js";import{T as re}from"./trash-2-CIGIiON9.js";import"./userService-fcNfPGgU.js";import"./leadService-C9Fz9Fh8.js";import"./officeService-pIKWPzAM.js";import"./universityService-BRxu1EnD.js";import"./courseService-C7fDnORS.js";import"./messageService-BIb6aoiZ.js";import"./reportService-CwYIj9jA.js";import"./createLucideIcon-Sm81qEul.js";const Oe=()=>{const{user:k}=K(),{callApi:u,loading:U,error:N}=J(),{hasPermission:m}=Q(),[B,v]=i.useState([]),[E,D]=i.useState([]),[l,S]=i.useState({search:"",role:"",officeId:""}),[R,h]=i.useState(!1),[d,p]=i.useState(null),[r,A]=i.useState({}),[y,c]=i.useState({show:!1,message:"",type:"success"}),[t,n]=i.useState({name:"",email:"",password:"",role:"",officeId:"",status:"active"}),F=[{value:"manager",label:"Manager"},{value:"receptionist",label:"Receptionist"},{value:"consultant",label:"Consultant"},{value:"instructor",label:"Instructor"}],C=[{value:"active",label:"Active",color:"bg-green-100 text-green-800"},{value:"inactive",label:"Inactive",color:"bg-red-100 text-red-800"}];i.useEffect(()=>{k&&m("manage","staff")&&(z(),M())},[k]);const z=async()=>{try{const s=await u("GET","/super-admin/offices");D((s==null?void 0:s.map(a=>({id:a.id,name:x(a.name)})))||[])}catch{c({show:!0,message:N||"Failed to fetch offices",type:"error"})}},M=async()=>{try{const s=await u("GET","/super-admin/staff");v((s==null?void 0:s.map(a=>({id:a.id,name:x(a.name||"Unknown"),email:x(a.email||"N/A"),role:a.role,officeId:a.officeId,officeName:x(a.officeName||"Unassigned"),status:a.status,createdAt:a.createdAt})))||[])}catch{c({show:!0,message:N||"Failed to fetch staff",type:"error"})}},$=async()=>{const s=W(t,!!d);if(Object.keys(s).length){A(s);return}try{const a={name:x(t.name),email:x(t.email),role:t.role,officeId:t.officeId||null,status:t.status};if(!d&&t.password&&(a.password=t.password),d){const o=await u("PUT",`/super-admin/staff/${d.id}`,a);v(j=>j.map(T=>T.id===o.id?o:T)),c({show:!0,message:"Staff updated successfully!",type:"success"})}else{const o=await u("POST","/super-admin/staff",a);v(j=>[...j,o]),c({show:!0,message:"Staff created successfully!",type:"success"})}b(),h(!1),p(null)}catch{c({show:!0,message:N||"Failed to save staff",type:"error"})}},G=async s=>{if(window.confirm("Are you sure you want to delete this staff member?"))try{await u("DELETE",`/super-admin/staff/${s}`),v(a=>a.filter(o=>o.id!==s)),c({show:!0,message:"Staff deleted successfully!",type:"success"})}catch{c({show:!0,message:N||"Failed to delete staff",type:"error"})}},b=()=>{n({name:"",email:"",password:"",role:"",officeId:"",status:"active"}),A({})},O=B.filter(s=>{const a=!l.search||s.name.toLowerCase().includes(l.search.toLowerCase())||s.email.toLowerCase().includes(l.search.toLowerCase()),o=!l.role||s.role===l.role,j=!l.officeId||s.officeId===l.officeId;return a&&o&&j}),q=s=>{var a;return((a=C.find(o=>o.value===s))==null?void 0:a.color)||"bg-gray-100 text-gray-800"},Y=[{key:"name",label:"Name",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.name})]})},{key:"email",label:"Email",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.email})]})},{key:"role",label:"Role",render:s=>e.jsx("span",{className:"text-sm capitalize",children:s.role})},{key:"officeName",label:"Office",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.officeName})]})},{key:"status",label:"Status",render:s=>{var a;return e.jsx(X,{className:q(s.status),children:(a=C.find(o=>o.value===s.status))==null?void 0:a.label})}},{key:"createdAt",label:"Created At",render:s=>e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Clock,{className:"h-4 w-4 mr-1"}),new Date(s.createdAt).toLocaleString()]})},{key:"actions",label:"Actions",render:s=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>{p(s),n({name:s.name,email:s.email,password:"",role:s.role,officeId:s.officeId||"",status:s.status}),h(!0)},disabled:!m("edit","staff"),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>G(s.id),className:"border-red-300 text-red-600 hover:bg-red-50",disabled:!m("delete","staff"),children:e.jsx(re,{className:"h-4 w-4"})})]})}];return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(H,{size:"lg"})}):m("manage","staff")?e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{isOpen:y.show,message:y.message,type:y.type,onClose:()=>c({...y,show:!1})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Staff Management"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage staff accounts."})]}),e.jsxs(f,{onClick:()=>{h(!0),p(null),b()},disabled:!m("create","staff"),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Create Staff"]})]}),R&&e.jsxs(I,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:d?"Edit Staff":"Create Staff"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx(w,{value:t.name,onChange:s=>n({...t,name:s.target.value}),placeholder:"Enter staff name",className:r.name?"border-red-500":""}),r.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx(w,{type:"email",value:t.email,onChange:s=>n({...t,email:s.target.value}),placeholder:"Enter staff email",className:r.email?"border-red-500":""}),r.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.email})]}),!d&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),e.jsx(w,{type:"password",value:t.password,onChange:s=>n({...t,password:s.target.value}),placeholder:"Enter password",className:r.password?"border-red-500":""}),r.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.password})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),e.jsx(g,{options:F,value:t.role,onChange:s=>n({...t,role:s}),className:r.role?"border-red-500":""}),r.role&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.role})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Office"}),e.jsx(g,{options:[{value:"",label:"Unassigned"},...E.map(s=>({value:s.id,label:s.name}))],value:t.officeId,onChange:s=>n({...t,officeId:s}),className:r.officeId?"border-red-500":""}),r.officeId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.officeId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx(g,{options:C.map(s=>({value:s.value,label:s.label})),value:t.status,onChange:s=>n({...t,status:s}),className:r.status?"border-red-500":""}),r.status&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.status})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(f,{variant:"outline",onClick:()=>{h(!1),p(null),b()},children:"Cancel"}),e.jsx(f,{onClick:$,children:d?"Update Staff":"Create Staff"})]})]}),e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(w,{placeholder:"Search by name or email...",value:l.search,onChange:s=>S({...l,search:s.target.value}),className:"pl-10"})]}),e.jsx(g,{options:[{value:"",label:"All Roles"},...F],value:l.role,onChange:s=>S({...l,role:s})}),e.jsx(g,{options:[{value:"",label:"All Offices"},...E.map(s=>({value:s.id,label:s.name}))],value:l.officeId,onChange:s=>S({...l,officeId:s})})]})}),e.jsxs(I,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Staff List"}),O.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No staff found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:Object.values(l).some(s=>s)?"No staff match your current filters.":"Create your first staff member to get started."}),e.jsxs(f,{onClick:()=>{h(!0),p(null),b()},disabled:!m("create","staff"),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Create First Staff"]})]}):e.jsx(Z,{data:O,columns:Y,pagination:!0,pageSize:10})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You do not have permission to manage staff."})]})};export{Oe as default};
