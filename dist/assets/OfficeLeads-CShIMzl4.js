import{r as d,j as e,B as f,L as z,y as O,u as I}from"./index-D_0a8VZH.js";import{u as _,m as A}from"./useManagerStore-BXFzQXT2.js";import{C as U}from"./Card-BZSd9g6-.js";import{B as H}from"./Badge-DnoA-fpa.js";import{I as w}from"./Input-CvXmBRSW.js";import{X as B}from"./x-DZDe4kcp.js";import{L as R}from"./LeadDetailsView-DOawn3lM.js";import{U as V}from"./user-plus-DPPOuk1r.js";import{S as W}from"./search-WQZEDZzZ.js";import{F as K}from"./file-text-C1gJtZnp.js";import{E as T}from"./eye-D1zuo86m.js";import{S as X}from"./square-pen-DP2r3-IP.js";import"./toDate-BKXxHYqX.js";import"./createLucideIcon-QavIXzvy.js";import"./user-Col8Dc6N.js";import"./mail-NeauaYI_.js";import"./phone-D-KHASr-.js";import"./users-8DbqKR1r.js";import"./calendar-CFgP2NK7.js";import"./globe-DqWFKqX7.js";import"./map-pin-Dpsu6ttS.js";import"./circle-alert-C7gzbhSX.js";import"./graduation-cap-Do7Wuoca.js";import"./book-open-DbrekBPc.js";import"./award-v-MKA7uy.js";import"./briefcase-CCsjQawY.js";import"./target-Bd_0vASp.js";import"./house-QsopEcn9.js";import"./star-BoEBFERM.js";import"./dollar-sign-CXh0vXW8.js";import"./info-BQUEcjA-.js";const F=({isOpen:N,onClose:p,lead:u,consultants:C,onSubmit:E,mode:l="add"})=>{const[n,r]=d.useState({studentData:{name:"",email:"",phone:""},studyPreferences:"",source:"referral",assignedConsultant:"",status:"new"}),[a,y]=d.useState({}),[g,S]=d.useState(!1);d.useEffect(()=>{r(u&&l==="edit"?{studentData:{name:"",email:"",phone:""},studyPreferences:"",source:"",assignedConsultant:u.assignedConsultant||"",status:u.status||"new"}:{studentData:{name:"",email:"",phone:""},studyPreferences:"",source:"referral",assignedConsultant:"",status:"new"})},[u,l]);const j=()=>{const s={};return l==="add"&&(n.studentData.name.trim()||(s.name="Name is required"),n.studentData.email.trim()?/\S+@\S+\.\S+/.test(n.studentData.email)||(s.email="Invalid email format"):s.email="Email is required",n.studentData.phone.trim()||(s.phone="Phone is required"),n.studyPreferences.trim()||(s.studyPreferences="Study preferences are required")),l==="edit"&&!n.status&&(s.status="Status is required"),y(s),Object.keys(s).length===0},x=s=>{const{name:i,value:c}=s.target;if(i.startsWith("studentData.")){const m=i.split(".")[1];r(h=>({...h,studentData:{...h.studentData,[m]:c}})),y(h=>({...h,[m]:""}))}else r(m=>({...m,[i]:c})),y(m=>({...m,[i]:""}))},k=async s=>{var i,c;if(s.preventDefault(),!!j()){S(!0);try{await E(n),O.success(l==="add"?"Lead created successfully":"Lead updated successfully",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"colored"}),p()}catch(m){O.error(((c=(i=m.response)==null?void 0:i.data)==null?void 0:c.error)||`Failed to ${l==="add"?"create":"update"} lead`,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"colored"})}finally{S(!1)}}};return N?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-lg max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:l==="add"?"Add Lead":"Edit Lead"}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-700 transition-colors duration-200",children:e.jsx(B,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[l==="add"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Student Name *"}),e.jsx(w,{type:"text",name:"studentData.name",value:n.studentData.name,onChange:x,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ${a.name?"border-red-500":""}`,placeholder:"Enter student name"}),a.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email *"}),e.jsx(w,{type:"email",name:"studentData.email",value:n.studentData.email,onChange:x,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ${a.email?"border-red-500":""}`,placeholder:"Enter email"}),a.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone *"}),e.jsx(w,{type:"text",name:"studentData.phone",value:n.studentData.phone,onChange:x,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ${a.phone?"border-red-500":""}`,placeholder:"Enter phone"}),a.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Study Preferences *"}),e.jsx(w,{type:"text",name:"studyPreferences",value:n.studyPreferences,onChange:x,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ${a.studyPreferences?"border-red-500":""}`,placeholder:"E.g., Undergraduate study in UK"}),a.studyPreferences&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.studyPreferences})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Source"}),e.jsxs("select",{name:"source",value:n.source,onChange:x,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"referral",children:"Referral"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"walk_in",children:"Walk-in"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Assigned Consultant"}),e.jsxs("select",{name:"assignedConsultant",value:n.assignedConsultant,onChange:x,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),l==="edit"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status *"}),e.jsxs("select",{name:"status",value:n.status,onChange:x,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm ${a.status?"border-red-500":""}`,children:[e.jsx("option",{value:"",children:"Select status"}),[{value:"new",label:"New"},{value:"in_progress",label:"In Progress"},{value:"converted",label:"Converted"},{value:"lost",label:"Lost"}].map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),a.status&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.status})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{variant:"outline",onClick:p,disabled:g,className:"border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),e.jsx(f,{type:"submit",variant:"primary",disabled:g,className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:g?e.jsxs("span",{className:"flex items-center",children:[e.jsx(z,{size:"sm",className:"mr-2 text-white"}),l==="add"?"Creating...":"Updating..."]}):l==="add"?"Create Lead":"Update Lead"})]})]})]})}):null},ke=()=>{I();const{leads:N,consultants:p,fetchLeads:u,fetchOfficeConsultants:C,loading:E,error:l,setState:n}=_(),[r,a]=d.useState({search:"",status:""}),[y,g]=d.useState(!1),[S,j]=d.useState(!1),[x,k]=d.useState(!1),[s,i]=d.useState(null),[c,m]=d.useState(1),h=10;d.useEffect(()=>{u(),C()},[u,C]),d.useEffect(()=>{l&&O.error(l,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,theme:"colored"})},[l]);const M=[{value:"",label:"All Statuses"},{value:"new",label:"New",color:"bg-gray-100 text-gray-800"},{value:"in_progress",label:"In Progress",color:"bg-blue-100 text-blue-800"},{value:"converted",label:"Converted",color:"bg-green-100 text-green-800"},{value:"lost",label:"Lost",color:"bg-red-100 text-red-800"}],L=N.filter(t=>{var v,D;const o=!r.search||((v=t.student)==null?void 0:v.name.toLowerCase().includes(r.search.toLowerCase()))||((D=t.student)==null?void 0:D.email.toLowerCase().includes(r.search.toLowerCase())),b=!r.status||t.status===r.status;return o&&b}),$=t=>{var o;return((o=M.find(b=>b.value===t))==null?void 0:o.color)||"bg-gray-100 text-gray-800"},P=Math.ceil(L.length/h),q=L.slice((c-1)*h,c*h);return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(z,{size:"lg",className:"text-blue-600"})}):e.jsxs("div",{className:"p-6 bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold text-gray-900 tracking-tight",children:"Office Leads"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage and track leads for your office"})]}),e.jsxs(f,{variant:"primary",onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Add Lead"]})]}),e.jsx(U,{className:"p-4 mt-8 shadow-md animate-fade-in bg-white",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(w,{placeholder:"Search by name or email...",value:r.search,onChange:t=>a({...r,search:t.target.value}),className:"pl-10 border-gray-300 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:r.status,onChange:t=>a({...r,status:t.target.value}),children:M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[L.length," of ",N.length," leads"]})]})}),e.jsxs(U,{className:"shadow-md mt-4 hover:shadow-lg transition-shadow duration-300 animate-fade-in bg-white",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 px-6 pt-4",children:"Leads"}),L.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Leads Found"}),e.jsx("p",{className:"text-gray-600",children:r.search||r.status?"No leads match your current filters.":"No leads available in your office."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Consultant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:q.map((t,o)=>{var b,v;return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors duration-200 ${o%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:((b=t.student)==null?void 0:b.name)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((v=t.student)==null?void 0:v.email)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(H,{className:$(t.status),children:t.status?t.status.replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase()):"New"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.consultantName||"Unassigned"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{i(t),k(!0)},className:"border-blue-300 text-blue-600 hover:bg-blue-50 transition-colors duration-200",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{i(t),j(!0)},className:"border-blue-300 text-blue-600 hover:bg-blue-50 transition-colors duration-200",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Edit"]})]})})]},t.id)})})]}),P>1&&e.jsxs("div",{className:"mt-4 flex justify-between items-center px-6 pb-4",children:[e.jsx(f,{variant:"outline",onClick:()=>m(t=>Math.max(t-1,1)),disabled:c===1,className:"border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors duration-200",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",c," of ",P]}),e.jsx(f,{variant:"outline",onClick:()=>m(t=>Math.min(t+1,P)),disabled:c===P,className:"border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors duration-200",children:"Next"})]})]})]}),e.jsx(F,{isOpen:y,onClose:()=>g(!1),consultants:p,onSubmit:async t=>{try{const o=await A.createLead(t);await u(),g(!1)}catch(o){throw o}},mode:"add"}),e.jsx(F,{isOpen:S,onClose:()=>{j(!1),i(null)},lead:s,consultants:p,onSubmit:async t=>{try{const o=await A.updateLead(s.id,{status:t.status,assignedConsultant:t.assignedConsultant||null});await u(),j(!1),i(null)}catch(o){throw o}},mode:"edit"}),x&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-4xl relative",children:[e.jsx("button",{onClick:()=>{k(!1),i(null)},className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 transition-colors duration-200",children:e.jsx(B,{className:"h-6 w-6"})}),e.jsx(R,{lead:s})]})})]})};export{ke as default};
