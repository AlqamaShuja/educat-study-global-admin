import{f as H,r as c,j as e,L as q,B as d}from"./index-D_0a8VZH.js";import{u as F}from"./useApi-DlTBhoZ7.js";import{C as i}from"./Card-BZSd9g6-.js";import{B as x}from"./Badge-DnoA-fpa.js";import{M as _}from"./Modal-C-TYXrEH.js";import{I as z}from"./Input-CvXmBRSW.js";import{B as A}from"./bell-Ce16hefo.js";import{S as W}from"./square-pen-DP2r3-IP.js";import{T as G}from"./target-Bd_0vASp.js";import{C as P}from"./circle-check-big-KsGiVaDX.js";import{T as V}from"./trending-up-Cw_lE7nU.js";import{P as J}from"./plus-DFJI7CJl.js";import{C as K}from"./calendar-CFgP2NK7.js";import{C as D}from"./clock-CRKKHv1b.js";import{C as Q}from"./circle-alert-C7gzbhSX.js";import"./userService-CYy00l9J.js";import"./leadService-BGFHSqvN.js";import"./officeService-CJb98nQG.js";import"./universityService-33LqWS7T.js";import"./courseService-BvKQP8zl.js";import"./messageService-C7q2WohE.js";import"./reportService-BE-X8rSB.js";import"./createLucideIcon-QavIXzvy.js";const we=()=>{const{studentId:u}=H(),{request:h,loading:T}=F(),[m,U]=c.useState([]),[r,N]=c.useState(null),[n,w]=c.useState(null),[E,g]=c.useState(!1),[I,j]=c.useState(!1),[X,Y]=c.useState(!1),[o,p]=c.useState({deadline:"",message:""}),[f,y]=c.useState(""),v=[{id:"profile_completion",title:"Profile Completion",description:"Complete student profile and preferences",weight:10},{id:"document_collection",title:"Document Collection",description:"Gather all required documents",weight:25},{id:"university_selection",title:"University Selection",description:"Choose target universities and programs",weight:15},{id:"application_preparation",title:"Application Preparation",description:"Prepare application materials",weight:20},{id:"application_submission",title:"Application Submission",description:"Submit applications to universities",weight:15},{id:"interview_preparation",title:"Interview Preparation",description:"Prepare for university interviews",weight:10},{id:"visa_application",title:"Visa Application",description:"Apply for student visa",weight:5}],S={not_started:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",blocked:"bg-red-100 text-red-800",pending_review:"bg-yellow-100 text-yellow-800"};c.useEffect(()=>{M()},[]),c.useEffect(()=>{if(u){const s=m.find(a=>a.id===u);s&&(N(s),b(u))}else m.length>0&&(N(m[0]),b(m[0].id))},[u,m]);const M=async()=>{try{const t=(await h("/consultant/leads")||[]).map(l=>{var C,k;return{id:l.studentId,name:((C=l.student)==null?void 0:C.name)||"Unknown",email:((k=l.student)==null?void 0:k.email)||"N/A",status:l.status,leadId:l.id}});U(t)}catch(s){console.error("Error fetching students:",s)}},b=async s=>{try{const a=await h(`/consultant/students/${s}/progress`),t={overallProgress:65,currentStep:"document_collection",steps:{profile_completion:{status:"completed",completedAt:"2024-06-01T10:00:00Z",progress:100,notes:"Profile completed successfully"},document_collection:{status:"in_progress",completedAt:null,progress:70,notes:"Missing IELTS certificate"},university_selection:{status:"not_started",completedAt:null,progress:0,notes:""},application_preparation:{status:"not_started",completedAt:null,progress:0,notes:""},application_submission:{status:"not_started",completedAt:null,progress:0,notes:""},interview_preparation:{status:"not_started",completedAt:null,progress:0,notes:""},visa_application:{status:"not_started",completedAt:null,progress:0,notes:""}},checklist:(a==null?void 0:a.checklist)||{items:[{task:"Submit passport copy",status:"completed"},{task:"Submit academic transcripts",status:"completed"},{task:"Submit IELTS certificate",status:"pending"},{task:"Submit personal statement",status:"pending"},{task:"Submit recommendation letters",status:"pending"}]},deadlines:[{id:"1",title:"IELTS Test Registration",date:"2024-06-25T00:00:00Z",status:"upcoming",priority:"high"},{id:"2",title:"University Application Deadline",date:"2024-07-15T00:00:00Z",status:"upcoming",priority:"urgent"},{id:"3",title:"Scholarship Application",date:"2024-06-30T00:00:00Z",status:"upcoming",priority:"medium"}],applicationStatus:(a==null?void 0:a.applicationStatus)||"in_progress",lastUpdated:"2024-06-18T14:30:00Z"};w(t)}catch(a){console.error("Error fetching application progress:",a)}},R=async()=>{if(!(!r||!f))try{await h(`/consultant/students/${r.id}/application-status`,{method:"PUT",data:{status:f}}),w(s=>({...s,applicationStatus:f,lastUpdated:new Date().toISOString()})),g(!1),y(""),alert("Application status updated successfully!")}catch(s){console.error("Error updating status:",s)}},$=async()=>{if(!r||!o.deadline||!o.message){alert("Please fill in all fields");return}try{await h(`/consultant/students/${r.id}/reminders`,{method:"POST",data:o}),j(!1),p({deadline:"",message:""}),alert("Reminder set successfully!")}catch(s){console.error("Error setting reminder:",s)}},B=()=>{if(!n)return 0;let s=0,a=0;return v.forEach(t=>{const l=n.steps[t.id];s+=t.weight,l.status==="completed"?a+=t.weight:l.status==="in_progress"&&(a+=t.weight*(l.progress/100))}),Math.round(a/s*100)},O=s=>{switch(s){case"completed":return e.jsx(P,{className:"h-5 w-5 text-green-500"});case"in_progress":return e.jsx(D,{className:"h-5 w-5 text-blue-500"});case"blocked":return e.jsx(Q,{className:"h-5 w-5 text-red-500"});case"pending_review":return e.jsx(D,{className:"h-5 w-5 text-yellow-500"});default:return e.jsx("div",{className:"h-5 w-5 bg-gray-300 rounded-full"})}},L=s=>({low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",Z=B();return T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(q,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Application Progress"}),e.jsx("p",{className:"text-gray-600",children:r?`Track ${r.name}'s application journey`:"Track student application progress"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(d,{variant:"outline",onClick:()=>j(!0),disabled:!r,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Set Reminder"]}),e.jsxs(d,{onClick:()=>g(!0),disabled:!r,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Update Status"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Students"})}),e.jsx(i.Content,{children:e.jsx("div",{className:"space-y-2",children:m.map(s=>e.jsxs("button",{onClick:()=>{N(s),b(s.id)},className:`w-full text-left p-3 rounded-lg border transition-colors ${(r==null?void 0:r.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),e.jsx(x,{className:"mt-1 text-xs",children:s.status})]},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-3 space-y-6",children:r&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{children:e.jsx(i.Content,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overall Progress"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[Z,"%"]})]})]})})}),e.jsx(i,{children:e.jsx(i.Content,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed Steps"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[Object.values(n.steps).filter(s=>s.status==="completed").length,"/",v.length]})]})]})})}),e.jsx(i,{children:e.jsx(i.Content,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx(x,{className:S[n.applicationStatus],children:n.applicationStatus.replace("_"," ").toUpperCase()})]})]})})})]}),e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Application Timeline"})}),e.jsx(i.Content,{children:e.jsx("div",{className:"space-y-6",children:v.map((s,a)=>{const t=n.steps[s.id],l=n.currentStep===s.id;return e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[O(t.status),a<v.length-1&&e.jsx("div",{className:`w-px h-12 mt-2 ${t.status==="completed"?"bg-green-300":"bg-gray-300"}`})]}),e.jsxs("div",{className:`flex-1 pb-6 ${l?"bg-blue-50 p-4 rounded-lg":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:S[t.status],children:t.status.replace("_"," ")}),t.status==="in_progress"&&e.jsxs("div",{className:"text-sm text-gray-600",children:[t.progress,"%"]})]})]}),t.status==="in_progress"&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${t.progress}%`}})})}),t.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("strong",{children:"Notes:"})," ",t.notes]}),t.completedAt&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Completed on"," ",new Date(t.completedAt).toLocaleDateString()]})]})]},s.id)})})})]}),e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Application Checklist"}),e.jsxs(d,{size:"sm",variant:"outline",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Add Item"]})]})}),e.jsx(i.Content,{children:e.jsx("div",{className:"space-y-3",children:n.checklist.items.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:s.status==="completed",readOnly:!0,className:"rounded border-gray-300"}),e.jsx("span",{className:`${s.status==="completed"?"text-gray-500 line-through":"text-gray-900"}`,children:s.task})]}),e.jsx(x,{className:s.status==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800",children:s.status})]},a))})})]}),e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Upcoming Deadlines"})}),e.jsx(i.Content,{children:e.jsx("div",{className:"space-y-3",children:n.deadlines.map(s=>{const a=new Date(s.date),t=Math.ceil((a-new Date)/(1e3*60*60*24));return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.toLocaleDateString(),t>0&&` (${t} days left)`,t===0&&" (Today)",t<0&&` (${Math.abs(t)} days overdue)`]})]})]}),e.jsx(x,{className:L(s.priority),children:s.priority})]},s.id)})})})]})]})})]}),e.jsx(_,{isOpen:E,onClose:()=>{g(!1),y("")},title:"Update Application Status",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["New Status for ",r==null?void 0:r.name]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:f,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"Select status..."}),e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"pending_review",children:"Pending Review"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"blocked",children:"Blocked"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(d,{variant:"outline",onClick:()=>{g(!1),y("")},children:"Cancel"}),e.jsx(d,{onClick:R,children:"Update Status"})]})]})}),e.jsx(_,{isOpen:I,onClose:()=>{j(!1),p({deadline:"",message:""})},title:"Set Deadline Reminder",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deadline Date"}),e.jsx(z,{type:"datetime-local",value:o.deadline,onChange:s=>p({...o,deadline:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reminder Message"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:3,value:o.message,onChange:s=>p({...o,message:s.target.value}),placeholder:"Enter reminder message..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(d,{variant:"outline",onClick:()=>{j(!1),p({deadline:"",message:""})},children:"Cancel"}),e.jsxs(d,{onClick:$,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Set Reminder"]})]})]})})]})};export{we as default};
