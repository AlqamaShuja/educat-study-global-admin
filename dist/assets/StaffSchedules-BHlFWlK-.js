import{j as e,B as x,r as u,y as f,L as ie}from"./index-B8d-T4_g.js";import{u as ce,m as E,a as b}from"./useManagerStore-BTCKwtdl.js";import{c as q,v as H}from"./validators-DJSRcNcx.js";import{C as R}from"./Card-BmdFGXxf.js";import{B as X}from"./Badge-C9Vyx7sP.js";import{M as G}from"./Modal-Dk_M0ZsZ.js";import{I as y}from"./Input-DF3u4mg_.js";import{X as me}from"./x-B8Viopl1.js";import{P as J}from"./plus-B_x-KCg8.js";import{S as ue}from"./search-v1ZxCjqm.js";import{C as xe}from"./calendar-dTGyL5Lu.js";import{U as he}from"./user-check-4txps9Az.js";import{C as K}from"./clock-G7bQhLke.js";import{S as fe}from"./square-pen-BaSEyL2h.js";import{T as be}from"./trash-2-CIGIiON9.js";import"./toDate-BKXxHYqX.js";import"./createLucideIcon-Sm81qEul.js";const ge=({isOpen:z,onClose:i,onConfirm:h,staffName:v})=>z?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Confirm Deletion"}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700",children:e.jsx(me,{className:"h-5 w-5"})})]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete the schedule for"," ",e.jsx("span",{className:"font-medium",children:v||"this staff member"}),"?"]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(x,{variant:"outline",onClick:i,children:"Cancel"}),e.jsx(x,{variant:"danger",onClick:h,className:"bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]})}):null,Le=()=>{const{user:z,consultants:i,schedules:h,setSchedules:v,fetchSchedules:Q,fetchOfficeConsultants:V,loading:W,error:O}=ce(),[o,A]=u.useState({search:"",staffId:"",date:""}),[Y,N]=u.useState(!1),[Z,T]=u.useState(!1),[ee,F]=u.useState(!1),[$,C]=u.useState(null),[w,B]=u.useState(null),[r,L]=u.useState({}),[g,se]=u.useState([]),[S,U]=u.useState(1),P=10,[t,n]=u.useState({studentId:"",staffId:"",startTime:"",endTime:"",type:"shift",status:"scheduled",notes:""}),I=[{value:"shift",label:"Shift",color:"bg-blue-100 text-blue-800"},{value:"meeting",label:"Meeting",color:"bg-green-100 text-green-800"}],k=[{value:"scheduled",label:"Scheduled",color:"bg-blue-100 text-blue-800"},{value:"completed",label:"Completed",color:"bg-green-100 text-green-800"},{value:"canceled",label:"Canceled",color:"bg-gray-100 text-gray-800"},{value:"no_show",label:"No Show",color:"bg-red-100 text-red-800"}];u.useEffect(()=>{Q(),V(),E.getStudents().then(se).catch(s=>{var l,a;f.error(((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to fetch students")})},[]),u.useEffect(()=>{O&&f.error(O||"Failed to fetch schedules")},[O]);const te=async()=>{var l,a;const s=q({...t,endTime:t.endTime||b(new Date(t.startTime),1).toISOString()});if(Object.keys(s).length){L(s);return}try{const c=[await E.createSchedule({...t,studentId:t.studentId,startTime:new Date(t.startTime).toISOString(),endTime:t.endTime?new Date(t.endTime).toISOString():b(new Date(t.startTime),1).toISOString(),notes:H(t.notes)}),...h];v(c),N(!1),j(),f.success("Schedule added successfully!")}catch(d){f.error(((a=(l=d.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to add schedule")}},ae=async()=>{var l,a;const s=q({...t,endTime:t.endTime||b(new Date(t.startTime),1).toISOString()});if(Object.keys(s).length){L(s);return}try{const d=await E.updateSchedule($.id,{...t,studentId:t.studentId,startTime:new Date(t.startTime).toISOString(),endTime:t.endTime?new Date(t.endTime).toISOString():b(new Date(t.startTime),1).toISOString(),notes:H(t.notes)});v(c=>c.map(p=>{var M;return p.id===$.id?{...d,staffName:((M=i.find(oe=>oe.id===d.staffId))==null?void 0:M.name)||"Unknown"}:p})),T(!1),C(null),j(),f.success("Schedule updated successfully!")}catch(d){f.error(((a=(l=d.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to update schedule")}},le=async()=>{var s,l;try{await E.deleteSchedule(w.id),v(a=>a.filter(d=>d.id!==w.id)),F(!1),B(null),f.success("Schedule deleted successfully!")}catch(a){f.error(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to delete schedule")}},re=s=>{B(s),F(!0)},j=()=>{n({studentId:"",staffId:"",startTime:"",endTime:"",type:"shift",status:"scheduled",notes:""}),L({})};console.log(h,"sakcnsacascnjsncscj");const m=h==null?void 0:h.filter(s=>{const l=!o.search||s.staffName.toLowerCase().includes(o.search.toLowerCase())||s.notes.toLowerCase().includes(o.search.toLowerCase()),a=!o.staffId||s.staffId===o.staffId,d=!o.date||new Date(s.startTime).toDateString()===new Date(o.date).toDateString();return l&&a&&d}),ne=s=>{var l;return((l=I.find(a=>a.value===s))==null?void 0:l.color)||"bg-gray-100 text-gray-800"},_=s=>{var l;return((l=k.find(a=>a.value===s))==null?void 0:l.color)||"bg-gray-100 text-gray-800"},D=Math.ceil((m==null?void 0:m.length)/P),de=m==null?void 0:m.slice((S-1)*P,S*P);return W?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ie,{size:"lg"})}):e.jsxs("div",{className:"space-y-6 p-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Staff Schedules"}),e.jsx("p",{className:"text-gray-600",children:"Manage schedules for your team members."})]}),e.jsxs(x,{variant:"primary",onClick:()=>N(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Schedule"]})]}),e.jsx(R,{className:"p-4 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(y,{placeholder:"Search by staff or notes...",value:o.search,onChange:s=>A({...o,search:s.target.value}),className:"pl-10 border-gray-300 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:o.staffId,onChange:s=>A({...o,staffId:s.target.value}),children:[e.jsx("option",{value:"",children:"All Staff"}),i==null?void 0:i.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(y,{type:"date",value:o.date,onChange:s=>A({...o,date:s.target.value}),className:"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[m==null?void 0:m.length," of ",h==null?void 0:h.length," schedules"]})]})}),e.jsxs(R,{className:"p-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Staff Schedules"}),(m==null?void 0:m.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No schedules found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:Object.values(o).some(s=>s)?"No schedules match your current filters.":"Add your first schedule to get started."}),e.jsxs(x,{variant:"primary",onClick:()=>N(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add First Schedule"]})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:[{key:"staffName",label:"Staff"},{key:"startTime",label:"Start Time"},{key:"endTime",label:"End Time"},{key:"type",label:"Type"},{key:"status",label:"Status"},{key:"notes",label:"Notes"},{key:"actions",label:"Actions"}].map(s=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s.label},s.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:de.map((s,l)=>{var a,d;return e.jsxs("tr",{className:`hover:bg-gray-50 ${l%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.staffName})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),new Date(s.startTime).toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),s.endTime?new Date(s.endTime).toLocaleString():b(new Date(s.startTime),1).toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx(X,{className:ne(s.type),children:(a=I.find(c=>c.value===s.type))==null?void 0:a.label})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx(X,{className:new Date(s.endTime||b(new Date(s.startTime),1))<new Date&&s.status==="scheduled"?_("no_show"):_(s.status),children:new Date(s.endTime||b(new Date(s.startTime),1))<new Date&&s.status==="scheduled"?"No Show":(d=k.find(c=>c.value===s.status))==null?void 0:d.label})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:s.notes||"N/A"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{const c=new Date(s.startTime),p=s.endTime?new Date(s.endTime):b(c,1);C(s),n({studentId:s.studentId,staffId:s.staffId,startTime:c.toISOString().slice(0,16),endTime:p.toISOString().slice(0,16),type:s.type,status:s.status,notes:s.notes}),T(!0)},className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>re(s),className:"border-red-300 text-red-600 hover:bg-red-50",children:e.jsx(be,{className:"h-4 w-4"})})]})})]},s.id)})})]}),D>1&&e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx(x,{variant:"outline",onClick:()=>U(s=>Math.max(s-1,1)),disabled:S===1,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",S," of ",D]}),e.jsx(x,{variant:"outline",onClick:()=>U(s=>Math.min(s+1,D)),disabled:S===D,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Next"})]})]})]}),e.jsx(G,{isOpen:Y,onClose:()=>{N(!1),j()},title:"Add Schedule",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student *"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${r.studentId?"border-red-500":""}`,value:t.studentId,onChange:s=>{var c,p;const l=s.target.value,a=g.find(M=>M.id===l),d=(p=(c=a==null?void 0:a.studentLeads)==null?void 0:c[0])==null?void 0:p.assignedConsultant;console.log(a,"asjnsajcsajcsnacna"),d?n({...t,studentId:l,staffId:d}):(f.error("This student is not assigned to any consultant."),n({...t,studentId:l,staffId:""}))},children:[e.jsx("option",{value:"",children:"Select a student"}),g==null?void 0:g.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.email]},s.id))]}),r.studentId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.studentId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Staff Member *"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${r.staffId?"border-red-500":""}`,value:t.staffId,onChange:s=>n({...t,staffId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a staff member"}),i==null?void 0:i.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),r.staffId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.staffId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),e.jsx(y,{type:"datetime-local",value:t.startTime,onChange:s=>n({...t,startTime:s.target.value,endTime:t.endTime||""}),className:r.startTime?"border-red-500":""}),r.startTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),e.jsx(y,{type:"datetime-local",value:t.endTime,onChange:s=>n({...t,endTime:s.target.value}),className:r.endTime?"border-red-500":""}),r.endTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:t.type,onChange:s=>n({...t,type:s.target.value}),children:I.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:t.status,onChange:s=>n({...t,status:s.target.value}),children:k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",rows:3,value:t.notes,onChange:s=>n({...t,notes:s.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(x,{variant:"outline",onClick:()=>{N(!1),j()},className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx(x,{variant:"primary",onClick:te,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Add Schedule"})]})]})}),e.jsx(G,{isOpen:Z,onClose:()=>{T(!1),C(null),j()},title:"Edit Schedule",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student *"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${r.studentId?"border-red-500":""}`,value:t.studentId,onChange:s=>n({...t,studentId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a student"}),g==null?void 0:g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),r.studentId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.studentId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Staff Member *"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${r.staffId?"border-red-500":""}`,value:t.staffId,onChange:s=>n({...t,staffId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a staff member"}),i==null?void 0:i.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),r.staffId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.staffId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),e.jsx(y,{type:"datetime-local",value:t.startTime,onChange:s=>n({...t,startTime:s.target.value,endTime:t.endTime||""}),className:r.startTime?"border-red-500":""}),r.startTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),e.jsx(y,{type:"datetime-local",value:t.endTime,onChange:s=>n({...t,endTime:s.target.value}),className:r.endTime?"border-red-500":""}),r.endTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:t.type,onChange:s=>n({...t,type:s.target.value}),children:I.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:t.status,onChange:s=>n({...t,status:s.target.value}),children:k.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",rows:3,value:t.notes,onChange:s=>n({...t,notes:s.target.value}),placeholder:"Enter any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(x,{variant:"outline",onClick:()=>{T(!1),C(null),j()},className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx(x,{variant:"primary",onClick:ae,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Update Schedule"})]})]})}),e.jsx(ge,{isOpen:ee,onClose:()=>F(!1),onConfirm:le,staffName:w==null?void 0:w.staffName})]})};export{Le as default};
