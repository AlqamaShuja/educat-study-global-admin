import{b as Y,r as n,j as e,L as $,B as f}from"./index-B8d-T4_g.js";import{u as q}from"./useApi-B1keMs2T.js";import{u as G,T as H}from"./Toast-COksXIC4.js";import{v as c,f as J}from"./validators-DJSRcNcx.js";import{C as T}from"./Card-BmdFGXxf.js";import{B as K}from"./Badge-C9Vyx7sP.js";import{M as Q}from"./Modal-Dk_M0ZsZ.js";import{I as V}from"./Input-DF3u4mg_.js";import{D as W}from"./DataTable-CjQSVmV5.js";import{S as Z}from"./shield-CzFdIWOm.js";import{S as _}from"./search-v1ZxCjqm.js";import{C as ee}from"./calendar-dTGyL5Lu.js";import{U as I}from"./user-check-4txps9Az.js";import{C as R}from"./clock-G7bQhLke.js";import{C as se}from"./check-9JHPRI_X.js";import{X as te}from"./x-B8Viopl1.js";import"./userService-fcNfPGgU.js";import"./leadService-C9Fz9Fh8.js";import"./officeService-pIKWPzAM.js";import"./universityService-BRxu1EnD.js";import"./courseService-C7fDnORS.js";import"./messageService-BIb6aoiZ.js";import"./reportService-CwYIj9jA.js";import"./Select-B_IZ9S1v.js";import"./createLucideIcon-Sm81qEul.js";const Te=()=>{const{user:w}=Y(),{callApi:i,services:m,loading:F,error:d}=q(),{hasPermission:u}=G(),[C,g]=n.useState([]),[E,L]=n.useState([]),[a,j]=n.useState({search:"",consultantId:"",status:""}),[z,p]=n.useState(!1),[S,h]=n.useState(null),[N,A]=n.useState({}),[x,o]=n.useState({show:!1,message:"",type:"success"}),[l,k]=n.useState({reason:""}),y=[{value:"scheduled",label:"Scheduled",color:"bg-blue-100 text-blue-800"},{value:"confirmed",label:"Confirmed",color:"bg-green-100 text-green-800"},{value:"rejected",label:"Rejected",color:"bg-red-100 text-red-800"},{value:"completed",label:"Completed",color:"bg-purple-100 text-purple-800"}];n.useEffect(()=>{w&&u("manage","appointments")&&(D(),M())},[w]);const D=async()=>{try{const s=await i(m.user.getTeamMembers);L((s==null?void 0:s.filter(t=>t.role==="consultant").map(t=>({id:t.id,name:c(t.name)})))||[])}catch{o({show:!0,message:d||"Failed to fetch consultants",type:"error"})}},M=async()=>{try{const s=await i(m.appointment.getAppointments);g((s==null?void 0:s.map(t=>({id:t.id,clientId:t.clientId,clientName:c(t.clientName||"Unknown"),consultantId:t.consultantId,consultantName:c(t.consultantName||"Unknown"),startTime:t.startTime,endTime:t.endTime,status:t.status,notes:c(t.notes||"")})))||[])}catch{o({show:!0,message:d||"Failed to fetch appointments",type:"error"})}},B=async s=>{try{await i(m.appointment.confirmAppointment,s),g(t=>t.map(r=>r.id===s?{...r,status:"confirmed"}:r)),o({show:!0,message:"Appointment confirmed successfully!",type:"success"})}catch{o({show:!0,message:d||"Failed to confirm appointment",type:"error"})}},O=async()=>{const s=J(l);if(Object.keys(s).length){A(s);return}try{await i(m.appointment.rejectAppointment,S.id,{reason:c(l.reason)}),g(t=>t.map(r=>r.id===S.id?{...r,status:"rejected",notes:l.reason}:r)),p(!1),h(null),b(),o({show:!0,message:"Appointment rejected successfully!",type:"success"})}catch{o({show:!0,message:d||"Failed to reject appointment",type:"error"})}},b=()=>{k({reason:""}),A({})},v=C.filter(s=>{const t=!a.search||s.clientName.toLowerCase().includes(a.search.toLowerCase())||s.consultantName.toLowerCase().includes(a.search.toLowerCase()),r=!a.consultantId||s.consultantId===a.consultantId,X=!a.status||s.status===a.status;return t&&r&&X}),U=s=>{var t;return((t=y.find(r=>r.value===s))==null?void 0:t.color)||"bg-gray-100 text-gray-800"},P=[{key:"clientName",label:"Client",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.clientName})]})},{key:"consultantName",label:"Consultant",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.consultantName})]})},{key:"startTime",label:"Start Time",render:s=>e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),new Date(s.startTime).toLocaleString()]})},{key:"endTime",label:"End Time",render:s=>e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),new Date(s.endTime).toLocaleString()]})},{key:"status",label:"Status",render:s=>{var t;return e.jsx(K,{className:U(s.status),children:(t=y.find(r=>r.value===s.status))==null?void 0:t.label})}},{key:"notes",label:"Notes",render:s=>e.jsx("span",{className:"text-sm",children:s.notes||"N/A"})},{key:"actions",label:"Actions",render:s=>e.jsx("div",{className:"flex space-x-2",children:s.status==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>B(s.id),disabled:!u("edit","appointments"),className:"border-green-300 text-green-600 hover:bg-green-50",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>{h(s),p(!0)},disabled:!u("edit","appointments"),className:"border-red-300 text-red-600 hover:bg-red-50",children:e.jsx(te,{className:"h-4 w-4"})})]})})}];return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{size:"lg"})}):u("manage","appointments")?e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{isOpen:x.show,message:x.message,type:x.type,onClose:()=>o({...x,show:!1})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Appointment Confirmations"}),e.jsx("p",{className:"text-gray-600",children:"Confirm or reject scheduled client appointments."})]})}),e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(V,{placeholder:"Search by client or consultant...",value:a.search,onChange:s=>j({...a,search:s.target.value}),className:"pl-10"})]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:a.consultantId,onChange:s=>j({...a,consultantId:s.target.value}),children:[e.jsx("option",{value:"",children:"All Consultants"}),E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:a.status,onChange:s=>j({...a,status:s.target.value}),children:[e.jsx("option",{value:"",children:"All Statuses"}),y.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[v.length," of ",C.length," appointments"]})]})}),e.jsxs(T,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Appointments"}),v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No appointments found"}),e.jsx("p",{className:"text-gray-600",children:Object.values(a).some(s=>s)?"No appointments match your current filters.":"No appointments are awaiting confirmation."})]}):e.jsx(W,{data:v,columns:P,pagination:!0,pageSize:10})]}),e.jsx(Q,{isOpen:z,onClose:()=>{p(!1),h(null),b()},title:"Reject Appointment",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason *"}),e.jsx("textarea",{className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 ${N.reason?"border-red-500":""}`,rows:4,value:l.reason,onChange:s=>k({...l,reason:s.target.value}),placeholder:"Enter the reason for rejecting this appointment..."}),N.reason&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:N.reason})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(f,{variant:"outline",onClick:()=>{p(!1),h(null),b()},children:"Cancel"}),e.jsx(f,{onClick:O,className:"bg-red-600 hover:bg-red-700",children:"Reject Appointment"})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You do not have permission to manage appointment confirmations."})]})};export{Te as default};
