import{r as m,j as e,L as G,B as h}from"./index-8BfwU0ug.js";import{u as q}from"./useApi-CYPgFTKK.js";import{u as R}from"./useAuth-DcN1mZj1.js";import{u as Y,T as Z}from"./Toast-BgXBk8cG.js";import{v as l,a as H}from"./validators-DJSRcNcx.js";import{C}from"./Card-D8yAsbgn.js";import{I as n}from"./Input-1qecWYJp.js";import{S as J}from"./Select-0k3J7if3.js";import{D as K}from"./DataTable-B3HSgOB5.js";import{S as Q}from"./shield-BJLPrUaL.js";import{P as k}from"./plus-x9Vd6qoA.js";import{S as V}from"./search-BAtyx4tz.js";import{B as z}from"./building-D8cbomhE.js";import{M as W}from"./map-pin-D_rU419Z.js";import{P as X}from"./phone-DUm5NSty.js";import{M as _}from"./mail-14nxtcVU.js";import{U as ee}from"./user-BqCmbBnp.js";import{S as se}from"./square-pen-C7wA0N2U.js";import{T as ae}from"./trash-2-DUEwUcLl.js";import"./userService-BNNDWOI3.js";import"./leadService-Cew0x-1D.js";import"./officeService-YCa5sj2e.js";import"./universityService-B9Qwd0nV.js";import"./courseService-IKGP0jCT.js";import"./messageService-CyNia2sF.js";import"./reportService-B_mrla-p.js";import"./createLucideIcon-DXfLnrkV.js";const Ae=()=>{const{user:w}=R(),{callApi:p,loading:A,error:g}=q(),{hasPermission:d}=Y(),[F,j]=m.useState([]),[I,P]=m.useState([]),[o,T]=m.useState({search:""}),[L,f]=m.useState(!1),[y,u]=m.useState(null),[t,O]=m.useState({}),[N,c]=m.useState({show:!1,message:"",type:"success"}),[a,i]=m.useState({name:"",address:"",city:"",state:"",zipCode:"",phone:"",email:"",managerId:""});m.useEffect(()=>{w&&d("manage","offices")&&(M(),U())},[w]);const M=async()=>{try{const s=await p("GET","/super-admin/managers");P((s==null?void 0:s.map(r=>({id:r.id,name:l(r.name)})))||[])}catch{c({show:!0,message:g||"Failed to fetch managers",type:"error"})}},U=async()=>{try{const s=await p("GET","/super-admin/offices");j((s==null?void 0:s.map(r=>({id:r.id,name:l(r.name||"Untitled"),address:l(r.address||"N/A"),city:l(r.city||"N/A"),state:l(r.state||"N/A"),zipCode:l(r.zipCode||"N/A"),phone:l(r.phone||"N/A"),email:l(r.email||"N/A"),managerId:r.managerId,managerName:l(r.managerName||"Unassigned"),createdAt:r.createdAt})))||[])}catch{c({show:!0,message:g||"Failed to fetch offices",type:"error"})}},$=async()=>{const s=H(a);if(Object.keys(s).length){O(s);return}try{const r={...a,name:l(a.name),address:l(a.address),city:l(a.city),state:l(a.state),zipCode:l(a.zipCode),phone:l(a.phone),email:l(a.email)};if(y){const x=await p("PUT",`/super-admin/offices/${y.id}`,r);j(v=>v.map(S=>S.id===x.id?x:S)),c({show:!0,message:"Office updated successfully!",type:"success"})}else{const x=await p("POST","/super-admin/offices",r);j(v=>[...v,x]),c({show:!0,message:"Office created successfully!",type:"success"})}b(),f(!1),u(null)}catch{c({show:!0,message:g||"Failed to save office",type:"error"})}},D=async s=>{if(window.confirm("Are you sure you want to delete this office?"))try{await p("DELETE",`/super-admin/offices/${s}`),j(r=>r.filter(x=>x.id!==s)),c({show:!0,message:"Office deleted successfully!",type:"success"})}catch{c({show:!0,message:g||"Failed to delete office",type:"error"})}},b=()=>{i({name:"",address:"",city:"",state:"",zipCode:"",phone:"",email:"",managerId:""}),O({})},E=F.filter(s=>!o.search||s.name.toLowerCase().includes(o.search.toLowerCase())||s.city.toLowerCase().includes(o.search.toLowerCase())),B=[{key:"name",label:"Office Name",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.name})]})},{key:"address",label:"Address",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:`${s.address}, ${s.city}, ${s.state} ${s.zipCode}`})]})},{key:"phone",label:"Phone",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.phone})]})},{key:"email",label:"Email",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.email})]})},{key:"managerName",label:"Manager",render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:s.managerName})]})},{key:"actions",label:"Actions",render:s=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{u(s),i({name:s.name,address:s.address,city:s.city,state:s.state,zipCode:s.zipCode,phone:s.phone,email:s.email,managerId:s.managerId||""}),f(!0)},disabled:!d("edit","offices"),children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>D(s.id),className:"border-red-300 text-red-600 hover:bg-red-50",disabled:!d("delete","offices"),children:e.jsx(ae,{className:"h-4 w-4"})})]})}];return A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"lg"})}):d("manage","offices")?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Z,{isOpen:N.show,message:N.message,type:N.type,onClose:()=>c({...N,show:!1})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Office Management"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage office locations."})]}),e.jsxs(h,{onClick:()=>{f(!0),u(null),b()},disabled:!d("create","offices"),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Create Office"]})]}),L&&e.jsxs(C,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:y?"Edit Office":"Create Office"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Office Name *"}),e.jsx(n,{value:a.name,onChange:s=>i({...a,name:s.target.value}),placeholder:"Enter office name",className:t.name?"border-red-500":""}),t.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address *"}),e.jsx(n,{value:a.address,onChange:s=>i({...a,address:s.target.value}),placeholder:"Enter address",className:t.address?"border-red-500":""}),t.address&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.address})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsx(n,{value:a.city,onChange:s=>i({...a,city:s.target.value}),placeholder:"Enter city",className:t.city?"border-red-500":""}),t.city&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.city})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State *"}),e.jsx(n,{value:a.state,onChange:s=>i({...a,state:s.target.value}),placeholder:"Enter state",className:t.state?"border-red-500":""}),t.state&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.state})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Zip Code *"}),e.jsx(n,{value:a.zipCode,onChange:s=>i({...a,zipCode:s.target.value}),placeholder:"Enter zip code",className:t.zipCode?"border-red-500":""}),t.zipCode&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.zipCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx(n,{type:"tel",value:a.phone,onChange:s=>i({...a,phone:s.target.value}),placeholder:"Enter phone number",className:t.phone?"border-red-500":""}),t.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx(n,{type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"Enter email",className:t.email?"border-red-500":""}),t.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager"}),e.jsx(J,{options:[{value:"",label:"Unassigned"},...I.map(s=>({value:s.id,label:s.name}))],value:a.managerId,onChange:s=>i({...a,managerId:s}),className:t.managerId?"border-red-500":""}),t.managerId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.managerId})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(h,{variant:"outline",onClick:()=>{f(!1),u(null),b()},children:"Cancel"}),e.jsx(h,{onClick:$,children:y?"Update Office":"Create Office"})]})]}),e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(n,{placeholder:"Search by office name or city...",value:o.search,onChange:s=>T({...o,search:s.target.value}),className:"pl-10"})]})}),e.jsxs(C,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Office List"}),E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No offices found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:o.search?"No offices match your search.":"Create your first office to get started."}),e.jsxs(h,{onClick:()=>{f(!0),u(null),b()},disabled:!d("create","offices"),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Create First Office"]})]}):e.jsx(K,{data:E,columns:B,pagination:!0,pageSize:10})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You do not have permission to manage offices."})]})};export{Ae as default};
